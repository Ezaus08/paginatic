<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Foro SharePoint 2007</title>
</head>

<body id="fondo" style="
margin:0;
background-color:black;
background-size:cover;
background-position:center;
background-repeat:no-repeat;
font-family:Arial, Helvetica, sans-serif;
color:white;
">

<!-- BOTÓN VOLVER -->
<div style="width:800px; margin:20px auto;">
    <a href="index.htm">
        <input type="button" value="← Volver"
        style="background-color:#00FFFF;color:black;padding:6px 12px;border:1px solid #009999;cursor:pointer;" />
    </a>
</div>

<!-- FORMULARIO -->
<div style="width:800px; margin:0 auto; border:1px solid #00FFFF; padding:20px; background:#111;">
    <h2 style="text-align:center;color:#00FFFF;">Publicar mensaje</h2>

    <table style="width:100%;">
        <tr>
            <td style="background:#00FFFF;color:black;padding:10px;width:90px;">Nombre</td>
            <td><input id="nombre" style="width:98%;" /></td>
        </tr>
        <tr>
            <td style="background:#00FFFF;color:black;padding:10px;">Mensaje</td>
            <td><textarea id="mensaje" rows="6" style="width:98%;"></textarea></td>
        </tr>
        <tr>
            <td colspan="2" style="text-align:center;padding-top:15px;">
                <button onclick="guardarMensaje()"
                style="background:#00FFFF;color:black;padding:8px 20px;">
                    Publicar mensaje
                </button>
            </td>
        </tr>
    </table>
</div>

<!-- FORO -->
<div style="width:800px; margin:20px auto;" id="foro">
    <h2 style="color:#00FFFF;">Mensajes publicados</h2>
</div>

<script type="text/javascript">
/* ========= SLIDER DE FONDO ========= */
var fondos = [
  "https://www.silicon.es/wp-content/uploads/2014/06/Fuente-Shutterstock_Autor-Sergey-Nivens_Internet.jpg",
  "https://www.internetmarketingai.net/wp-content/uploads/que-es-internet-de-las-cosas.jpg",
  "https://marketing4ecommerce.net/wp-content/uploads/2024/01/usuarios-de-internet-en-el-mundo.jpg"
];

var iFondo = 0;
document.body.style.backgroundImage = "url('" + fondos[0] + "')";

setInterval(function () {
    iFondo = (iFondo + 1) % fondos.length;
    document.body.style.backgroundImage = "url('" + fondos[iFondo] + "')";
}, 5000);

/* ========= GUARDAR MENSAJE ========= */
function guardarMensaje() {
    var nombre = document.getElementById("nombre").value;
    var mensaje = document.getElementById("mensaje").value;

    if (nombre === "" || mensaje === "") {
        alert("Completa todos los campos");
        return;
    }

    var soap =
    '<?xml version="1.0" encoding="utf-8"?>' +
    '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ' +
    'xmlns:xsd="http://www.w3.org/2001/XMLSchema" ' +
    'xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
    '<soap:Body>' +
    '<UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">' +
    '<listName>ForoMensajes</listName>' +
    '<updates>' +
    '<Batch OnError="Continue">' +
    '<Method ID="1" Cmd="New">' +
    '<Field Name="Title">' + nombre + '</Field>' +
    '<Field Name="Mensaje">' + mensaje + '</Field>' +
    '</Method>' +
    '</Batch>' +
    '</updates>' +
    '</UpdateListItems>' +
    '</soap:Body>' +
    '</soap:Envelope>';

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/_vti_bin/Lists.asmx", true);
    xhr.setRequestHeader("Content-Type", "text/xml; charset=utf-8");
    xhr.setRequestHeader("SOAPAction",
      "http://schemas.microsoft.com/sharepoint/soap/UpdateListItems");

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            document.getElementById("nombre").value = "";
            document.getElementById("mensaje").value = "";
            cargarMensajes();
        }
    };
    xhr.send(soap);
}

/* ========= CARGAR MENSAJES ========= */
function cargarMensajes() {

    var soap =
    '<?xml version="1.0" encoding="utf-8"?>' +
    '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ' +
    'xmlns:xsd="http://www.w3.org/2001/XMLSchema" ' +
    'xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
    '<soap:Body>' +
    '<GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">' +
    '<listName>ForoMensajes</listName>' +
    '</GetListItems>' +
    '</soap:Body>' +
    '</soap:Envelope>';

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/_vti_bin/Lists.asmx", true);
    xhr.setRequestHeader("Content-Type", "text/xml; charset=utf-8");
    xhr.setRequestHeader("SOAPAction",
      "http://schemas.microsoft.com/sharepoint/soap/GetListItems");

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {

            var xml = xhr.responseXML;
            var rows = xml.getElementsByTagName("z:row");
            var html = '<h2 style="color:#00FFFF;">Mensajes publicados</h2>';

            for (var i = rows.length - 1; i >= 0; i--) {
                html +=
                '<div style="border:1px solid #00FFFF;padding:10px;margin:10px 0;background:#111;">' +
                '<strong>' + rows[i].getAttribute("ows_Title") + '</strong>' +
                '<p>' + rows[i].getAttribute("ows_Mensaje") + '</p>' +
                '</div>';
            }

            document.getElementById("foro").innerHTML = html;
        }
    };
    xhr.send(soap);
}

cargarMensajes();
</script>

</body>
</html>

